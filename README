# AiChat

Next.js-based RAG (Retrieval-Augmented Generation) backend API + an embeddable chat widget.

## Contents

- [Structure](#structure)
- [Prerequisites](#prerequisites)
- [Configuration (.env)](#configuration-env)
- [Quickstart (Docker)](#quickstart-docker)
- [Local development](#local-development)
- [API endpoints](#api-endpoints)
- [Troubleshooting](#troubleshooting)

## Structure

```
.
├── backend-rag-api/      # API routes, indexing, RAG logic
└── frontend-widget/     # embeddable chat UI (Next.js)
```

## Prerequisites

- **Docker + Docker Compose** (recommended)
- **Node.js 20+** (for local development)
- On Linux (local builds): `build-essential`, `python3`, etc. (required by the native `hnswlib-node` module)

## Configuration (.env)

**Required (backend):**

```bash
GEMINI_API_KEY=your_api_key_here
```

**Only if you use the RAG endpoint (/api/rag):**

```bash
COHERE_API_KEY=your_api_key_here
```

**Optional (frontend):**

```bash
NEXT_PUBLIC_BASE_URL=http://localhost:3000
```

Note: never commit real keys to a public repository. Keep secrets in `.env` locally and publish an `.env.example` template instead.

## Quickstart (Docker)

### 1) Start the backend

```bash
cd backend-rag-api
docker compose up --build
```

### 2) Index the documents

```bash
docker exec -it rag_api npm run load-data
```

Important: document-based retrieval works properly only after indexing has completed.

## Local development

### Backend

```bash
cd backend-rag-api
npm install
npm run dev
```

Indexing locally:

```bash
cd backend-rag-api
npm run load-data
```

### Frontend widget

```bash
cd frontend-widget
npm install
npm run dev
```

## API endpoints

Base URL: `http://localhost:3000`

### Chat (LLM response)

`POST /api/chat`

```bash
curl -s http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"question":"Hello"}'
```

### RAG (document-aware response)

`POST /api/rag`

```bash
curl -s http://localhost:3000/api/rag \
  -H "Content-Type: application/json" \
  -d '{"question":"What is described in the documentation?"}'
```

## Troubleshooting

- **CORS errors**: verify `NEXT_PUBLIC_BASE_URL` and the backend CORS configuration.
- **Missing index**: run indexing (`npm run load-data`) before using `/api/rag`.
- **Native build errors (`hnswlib-node`)**: install build tools (`build-essential`, `python3`, …).
- **Missing env vars**: `GEMINI_API_KEY` is required; `/api/rag` also needs `COHERE_API_KEY`.